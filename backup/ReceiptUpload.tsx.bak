import { useState } from "react";
import { Box, Button, Input, Text, VStack, useToast } from "@chakra-ui/react";
import { useNavigate } from "react-router-dom";

export function ReceiptUpload() {
  const [file, setFile] = useState<File | null>(null);
  const [uploading, setUploading] = useState(false);
  const navigate = useNavigate();
  const toast = useToast();

  const handleUpload = async () => {
    if (!file) return;

    const formData = new FormData();
    formData.append("receipt", file);

    setUploading(true);

    const res = await fetch("http://localhost:3001/receipts/upload", {
      method: "POST",
      body: formData,
    });

    setUploading(false);

    if (!res.ok) {
      toast({
        title: "Upload mislukt",
        description: "Probeer het opnieuw.",
        status: "error",
        duration: 3000,
        isClosable: true,
      });
      return;
    }

    toast({
      title: "Bon ge√ºpload",
      description: "De bon is succesvol verwerkt.",
      status: "success",
      duration: 2500,
      isClosable: true,
    });
    console.log("Navigating to receipts...");
    navigate("/receipts");
  };

  return (
    <Box p={4} borderWidth="1px" borderRadius="md">
      <VStack align="start" spacing={4}>
        <Text>Kies een kassabon (foto of PDF)</Text>

        <Input
          type="file"
          accept="image/*,.pdf"
          onChange={(e) => setFile(e.target.files?.[0] || null)}
        />

        <Button
          colorScheme="blue"
          onClick={handleUpload}
          isLoading={uploading}
          isDisabled={!file}
        >
          Uploaden
        </Button>
      </VStack>
    </Box>
  );
}
